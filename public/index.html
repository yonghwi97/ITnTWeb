<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SV3 SW ì´ë¦„ ê³µëª¨ì „</title>
    <style>
		body {
			font-family: 'Noto Sans KR', sans-serif;
			background-color: #eef1f5;
			display: flex;
			justify-content: center;
			align-items: flex-start;
			gap: 40px;
			padding: 50px;
			margin: 0;
		}
		.form-container, .vote-container {
			background: white;
			padding: 30px 40px;
			border-radius: 16px;
			box-shadow: 0 6px 18px rgba(0,0,0,0.1);
			width: 420px;
		}
		h1 {
			text-align: center;
			color: #222;
			font-size: 24px;
			margin-bottom: 20px;
		}
		label {
			display: block;
			margin-bottom: 6px;
			font-weight: bold;
			color: #555;
			margin-top: 10px;
		}
		input, textarea {
			width: 100%;
			padding: 12px;
			margin-bottom: 18px;
			border: 1px solid #ddd;
			border-radius: 8px;
			font-size: 15px;
			box-sizing: border-box;
			background-color: #fafafa;
		}
		.submit-btn {
			width: 100%;
			padding: 14px;
			background-color: #5c7cfa;
			color: white;
			border: none;
			border-radius: 8px;
			font-size: 16px;
			font-weight: bold;
			transition: background-color 0.3s ease;
			margin-top: 10px;
		}
		.submit-btn:hover {
			background-color: #4c6ef5;
		}
		
		.vote-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			background: #f8f9fa;
			padding: 12px 18px;
			border-radius: 8px;
			margin-bottom: 10px;
			box-shadow: 0 2px 6px rgba(0,0,0,0.06);
			font-size: 16px;
		}
		.vote-info {
			display: flex;
			align-items: center;
			gap: 8px;
			font-weight: 500;
			color: #333;
		}
		.vote-rank {
			font-weight: bold;
			color: #5c7cfa;
			font-size: 18px;
		}
		.vote-button {
			background: none;
			border: none;
			font-size: 26px;
			color: #5c7cfa;
			cursor: pointer;
			transition: color 0.3s ease;
		}
		.vote-button:hover {
			color: #4c6ef5;
		}
    </style>
</head>
<body>

    <div class="vote-container">
        <h1>íˆ¬í‘œ ëª©ë¡</h1>
        <div id="voteList">
            <!-- SW ì´ë¦„ê³¼ íˆ¬í‘œ ë²„íŠ¼ì´ ì¶”ê°€ë  ë¶€ë¶„ -->
        </div>
    </div>

    <div class="form-container">
        <h1>ì´ë¦„ ê³µëª¨</h1>
		<form id="submissionForm">
			<label for="name">ì´ë¦„</label>
			<input type="text" id="name" name="name" required>
		
			<label for="suggestedName">SW ì´ë¦„</label>
			<input type="text" id="suggestedName" name="suggestedName" required>
		
			<label for="reason">ì‚¬ìœ </label>
			<textarea id="reason" name="reason" rows="4" required></textarea>
		
			<button class="submit-btn" type="submit">ì œì¶œí•˜ê¸°</button>
		</form>
    </div>


	<script>
	let votes = [];  // ì „ì—­ votes ë°°ì—´ ì¶”ê°€
	
	const form = document.getElementById('submissionForm');
	const voteList = document.getElementById('voteList');
	
	form.addEventListener('submit', async function(event) {
    event.preventDefault();

    const name = document.getElementById('name').value.trim();
    const suggestedName = document.getElementById('suggestedName').value.trim();
    const reason = document.getElementById('reason').value.trim();

    const data = { name, suggestedName, reason };

    // ì œì¶œ ì „ì— ì¤‘ë³µ ì²´í¬
    const existingNames = votes.map(v => v.suggested_name.toLowerCase());
    if (existingNames.includes(suggestedName.toLowerCase())) {
        showPopup('â—ï¸ ì´ë¯¸ ë“±ë¡ëœ SW ì´ë¦„ì…ë‹ˆë‹¤.');
        return;
    }

    try {
        const response = await fetch('/submit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            showPopup('ì œì¶œ ì™„ë£Œ! ê°ì‚¬í•©ë‹ˆë‹¤!');
            form.reset();
            await fetchNames();
        } else {
            showPopup('â—ï¸ ì œì¶œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
        }
    } catch (error) {
        console.error('ì—ëŸ¬:', error);
        showPopup('â—ï¸ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ');
    }
	});


	
	// ì´ë¦„ + íˆ¬í‘œìˆ˜ ê°€ì ¸ì˜¤ê¸°
	async function fetchNames() {
		try {
			const response = await fetch('/names');
			const names = await response.json();
			votes = names;  // ì„œë²„ì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ ì „ì—­ votesì— ì €ì¥
			renderVotes(votes);
		} catch (error) {
			console.error('ì´ë¦„ ê°€ì ¸ì˜¤ê¸° ì—ëŸ¬:', error);
		}
	}

	
	// íˆ¬í‘œ ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
	async function vote(suggestedName) {
		const userName = prompt('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
		if (!userName) {
			showPopup('â—ï¸ ì´ë¦„ì„ ì…ë ¥í•´ì•¼ íˆ¬í‘œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
			return;
		}
		try {
			const response = await fetch('/vote', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({
					userName: userName,
					suggestedName: suggestedName
				})
			});
			if (response.ok) {
				showPopup(`${suggestedName}ì— íˆ¬í‘œ ì™„ë£Œ!`);
				await fetchNames(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
			} else {
				const errorMessage = await response.text();
				showPopup(errorMessage);
			}
		} catch (error) {
			console.error('íˆ¬í‘œ ì—ëŸ¬:', error);
			showPopup('ì„œë²„ ì˜¤ë¥˜ ë°œìƒ');
		}
	}


	
	// ì´ë¦„ ëª©ë¡ í™”ë©´ì— í‘œì‹œ
	function renderVotes(votes) {
		voteList.innerHTML = '';
		votes.sort((a, b) => b.vote_count - a.vote_count);
	
		votes.forEach((item, index) => {
			const div = document.createElement('div');
			div.className = 'vote-item';
	
			const info = document.createElement('div');
			info.className = 'vote-info';
	
			let rankBadge = `${index + 1}ë“±`;
			let backgroundColor = '#f8f9fa';
	
			if (index === 0) {
				rankBadge = 'ğŸ† 1ë“±';
				backgroundColor = '#ff6b6b';
			} else if (index === 1) {
				rankBadge = 'ğŸ¥ˆ 2ë“±';
				backgroundColor = '#ffa94d';
			} else if (index === 2) {
				rankBadge = 'ğŸ¥‰ 3ë“±';
				backgroundColor = '#ffd43b';
			}
	
			info.innerHTML = `
				<span class="vote-rank">${rankBadge}</span> 
				<span class="sw-name" data-reason="${item.reason || 'ì‚¬ìœ  ì—†ìŒ'}">${item.suggested_name}</span> 
				(${item.vote_count}í‘œ)
			`;
	
			div.style.backgroundColor = backgroundColor;
	
			const button = document.createElement('button');
			button.className = 'vote-button';
			button.innerHTML = 'ğŸ‘';
			button.onclick = () => vote(item.suggested_name);
	
			div.appendChild(info);
			div.appendChild(button);
			voteList.appendChild(div);
		});
	
		addTooltipEvents(); // âœ… íˆ´íŒ ì´ë²¤íŠ¸ ì—°ê²°
	}
	
	function addTooltipEvents() {
    const swNames = document.querySelectorAll('.sw-name');

    swNames.forEach(sw => {
        sw.addEventListener('mouseenter', function (e) {
            const reason = e.target.getAttribute('data-reason');
            showTooltip(reason, e.pageX, e.pageY);
        });
        sw.addEventListener('mouseleave', function () {
            hideTooltip();
        });
    });
	}

	function showTooltip(text, x, y) {
		let tooltip = document.getElementById('tooltip');
		if (!tooltip) {
			tooltip = document.createElement('div');
			tooltip.id = 'tooltip';
			tooltip.style.position = 'absolute';
			tooltip.style.background = '#333';
			tooltip.style.color = 'white';
			tooltip.style.padding = '8px 12px';
			tooltip.style.borderRadius = '8px';
			tooltip.style.fontSize = '14px';
			tooltip.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
			tooltip.style.transition = 'opacity 0.3s ease';
			tooltip.style.pointerEvents = 'none';
			tooltip.style.opacity = '0';
			document.body.appendChild(tooltip);
		}
	
		tooltip.textContent = text;
		tooltip.style.left = (x + 10) + 'px';
		tooltip.style.top = (y + 10) + 'px';
		tooltip.style.opacity = '1';
	}
	
	function hideTooltip() {
		const tooltip = document.getElementById('tooltip');
		if (tooltip) {
			tooltip.style.opacity = '0';
			setTimeout(() => {
				if (tooltip) {
					tooltip.remove();
				}
			}, 300);
		}
	}

	
	// íŒì—… í‘œì‹œ
	function showPopup(message) {
		const popup = document.createElement('div');
		popup.textContent = message;
		popup.style.position = 'fixed';
		popup.style.top = '50%';
		popup.style.left = '50%';
		popup.style.transform = 'translate(-50%, -50%)';
		popup.style.background = '#333';
		popup.style.color = 'white';
		popup.style.padding = '20px 40px';
		popup.style.borderRadius = '12px';
		popup.style.fontSize = '18px';
		popup.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.2)';
		popup.style.opacity = '0';
		popup.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
		document.body.appendChild(popup);
	
		setTimeout(() => {
			popup.style.opacity = '1';
			popup.style.transform = 'translate(-50%, -50%) scale(1.05)';
		}, 10);
	
		setTimeout(() => {
			popup.style.opacity = '0';
			popup.style.transform = 'translate(-50%, -50%) scale(0.9)';
			setTimeout(() => {
				popup.remove();
			}, 500);
		}, 2000);
	}
	
	// í˜ì´ì§€ ì²˜ìŒ ë¡œë”©í•  ë•Œ
	fetchNames();
	
	// 10ì´ˆë§ˆë‹¤ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
	setInterval(fetchNames, 10000);
	</script>


</body>
</html>
