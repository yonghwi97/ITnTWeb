<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SV3 SW 이름 공모전</title>
    <style>
		body {
			font-family: 'Noto Sans KR', sans-serif;
			background-color: #eef1f5;
			display: flex;
			justify-content: center;
			align-items: flex-start;
			gap: 40px;
			padding: 50px;
			margin: 0;
		}
		.form-container, .vote-container {
			background: white;
			padding: 30px 40px;
			border-radius: 16px;
			box-shadow: 0 6px 18px rgba(0,0,0,0.1);
			width: 420px;
		}
		h1 {
			text-align: center;
			color: #222;
			font-size: 24px;
			margin-bottom: 20px;
		}
		label {
			display: block;
			margin-bottom: 6px;
			font-weight: bold;
			color: #555;
			margin-top: 10px;
		}
		input, textarea {
			width: 100%;
			padding: 12px;
			margin-bottom: 18px;
			border: 1px solid #ddd;
			border-radius: 8px;
			font-size: 15px;
			box-sizing: border-box;
			background-color: #fafafa;
		}
		.submit-btn {
			width: 100%;
			padding: 14px;
			background-color: #5c7cfa;
			color: white;
			border: none;
			border-radius: 8px;
			font-size: 16px;
			font-weight: bold;
			transition: background-color 0.3s ease;
			margin-top: 10px;
		}
		.submit-btn:hover {
			background-color: #4c6ef5;
		}
		
		.vote-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			background: #f8f9fa;
			padding: 12px 18px;
			border-radius: 8px;
			margin-bottom: 10px;
			box-shadow: 0 2px 6px rgba(0,0,0,0.06);
			font-size: 16px;
		}
		.vote-info {
			display: flex;
			align-items: center;
			gap: 8px;
			font-weight: 500;
			color: #333;
		}
		.vote-rank {
			font-weight: bold;
			color: #5c7cfa;
			font-size: 18px;
		}
		.vote-button {
			background: none;
			border: none;
			font-size: 26px;
			color: #5c7cfa;
			cursor: pointer;
			transition: color 0.3s ease;
		}
		.vote-button:hover {
			color: #4c6ef5;
		}
    </style>
</head>
<body>

    <div class="vote-container">
        <h1>투표 목록</h1>
        <div id="voteList">
            <!-- SW 이름과 투표 버튼이 추가될 부분 -->
        </div>
    </div>

    <div class="form-container">
        <h1>이름 공모</h1>
		<form id="submissionForm">
			<label for="name">이름</label>
			<input type="text" id="name" name="name" required>
		
			<label for="suggestedName">SW 이름</label>
			<input type="text" id="suggestedName" name="suggestedName" required>
		
			<label for="reason">사유</label>
			<textarea id="reason" name="reason" rows="4" required></textarea>
		
			<button class="submit-btn" type="submit">제출하기</button>
		</form>
    </div>


	<script>
	const form = document.getElementById('submissionForm');
	const voteList = document.getElementById('voteList');
	
	form.addEventListener('submit', async function(event) {
		event.preventDefault();
	
		const employeeId = document.getElementById('employeeId').value.trim();
		const name = document.getElementById('name').value.trim();
		const suggestedName = document.getElementById('suggestedName').value.trim();
		const reason = document.getElementById('reason').value.trim();
	
		const data = { employeeId, name, suggestedName, reason };
	
		try {
			const response = await fetch('/submit', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify(data)
			});
	
			if (response.ok) {
				showPopup('🎉 제출 완료! 감사합니다!');
				form.reset();
				await fetchNames();
			} else {
				showPopup('❗️ 제출 실패. 다시 시도하세요.');
			}
		} catch (error) {
			console.error('에러:', error);
			showPopup('❗️ 서버 오류 발생');
		}
	});
	
	// 이름 + 투표수 가져오기
	async function fetchNames() {
		try {
			const response = await fetch('/names');
			const names = await response.json();
			renderVotes(names);
		} catch (error) {
			console.error('이름 가져오기 에러:', error);
		}
	}
	
	// 투표 버튼 눌렀을 때
	async function vote(suggestedName) {
		const userName = prompt('이름을 입력하세요:');
		if (!userName) {
			showPopup('❗️ 이름을 입력해야 투표할 수 있습니다.');
			return;
		}
		try {
			const response = await fetch('/vote', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({
					userName: userName,
					suggestedName: suggestedName
				})
			});
			if (response.ok) {
				showPopup(`✅ ${suggestedName}에 투표 완료!`);
				await fetchNames(); // 목록 새로고침
			} else {
				const errorMessage = await response.text();
				showPopup('❗️ ' + errorMessage);
			}
		} catch (error) {
			console.error('투표 에러:', error);
			showPopup('❗️ 서버 오류 발생');
		}
	}


	
	// 이름 목록 화면에 표시
	function renderVotes(votes) {
		voteList.innerHTML = '';
		votes.sort((a, b) => b.vote_count - a.vote_count);
	
		votes.forEach((item, index) => {
			const div = document.createElement('div');
			div.className = 'vote-item';
	
			const info = document.createElement('div');
			info.className = 'vote-info';
			info.innerHTML = `<span class="vote-rank">${index + 1}등</span> ${item.suggested_name} (${item.vote_count}표)`;
	
			const button = document.createElement('button');
			button.className = 'vote-button';
			button.innerHTML = '👍';
			button.onclick = () => vote(item.suggested_name);
	
			div.appendChild(info);
			div.appendChild(button);
			voteList.appendChild(div);
		});
	}


	
	// 팝업 표시
	function showPopup(message) {
		const popup = document.createElement('div');
		popup.textContent = message;
		popup.style.position = 'fixed';
		popup.style.top = '50%';
		popup.style.left = '50%';
		popup.style.transform = 'translate(-50%, -50%)';
		popup.style.background = '#333';
		popup.style.color = 'white';
		popup.style.padding = '20px 40px';
		popup.style.borderRadius = '12px';
		popup.style.fontSize = '18px';
		popup.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.2)';
		popup.style.opacity = '0';
		popup.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
		document.body.appendChild(popup);
	
		setTimeout(() => {
			popup.style.opacity = '1';
			popup.style.transform = 'translate(-50%, -50%) scale(1.05)';
		}, 10);
	
		setTimeout(() => {
			popup.style.opacity = '0';
			popup.style.transform = 'translate(-50%, -50%) scale(0.9)';
			setTimeout(() => {
				popup.remove();
			}, 500);
		}, 2000);
	}
	
	// 페이지 처음 로딩할 때
	fetchNames();
	
	// 10초마다 최신 데이터 가져오기
	setInterval(fetchNames, 10000);
	</script>


</body>
</html>
