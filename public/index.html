<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SV3 SW Ïù¥Î¶Ñ Í≥µÎ™®Ï†Ñ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f2f2f2;
            font-family: 'Arial', sans-serif;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 30px;
            gap: 30px;
        }
        .form-container, .ranking-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 500px;
        }
        .form-container {
            min-width: 500px;
        }
        .ranking-container {
            min-width: 400px;
        }
        h1, h2 {
            text-align: center;
            margin-bottom: 24px;
            color: #333;
        }
        label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin-top: 6px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .vote-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
            background-color: #f8f9fa;
            cursor: pointer;
        }
        .vote-item:hover {
            transform: scale(1.02);
        }
        .vote-info {
            font-weight: 600;
            color: #1c1c1c;
        }
        .vote-button {
            background: none;
            border: none;
            font-size: 28px;
            color: #5c7cfa;
            cursor: pointer;
        }
        .vote-button:hover {
            color: #4c6ef5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="ranking-container">
            <h2>Ìà¨Ìëú ÏàúÏúÑ</h2>
            <div id="voteList"></div>
        </div>

        <div class="form-container">
            <h1>SV3 SW Ïù¥Î¶Ñ Í≥µÎ™®Ï†Ñ</h1>
            <form id="submissionForm">
                <label for="name">Ïù¥Î¶Ñ</label>
                <input type="text" id="name" name="name" required>

                <label for="suggestedName">SW Ïù¥Î¶Ñ</label>
                <input type="text" id="suggestedName" name="suggestedName" required>

                <label for="reason">ÏÇ¨Ïú†</label>
                <textarea id="reason" name="reason" rows="4" required></textarea>

                <button type="submit">Ï†úÏ∂úÌïòÍ∏∞</button>
            </form>
        </div>
    </div>

    <script>
        const voteList = document.getElementById('voteList');
        const form = document.getElementById('submissionForm');

        async function fetchNames() {
            try {
                const response = await fetch('/names');
                const names = await response.json();
                renderVotes(names);
            } catch (error) {
                console.error('Ïù¥Î¶Ñ Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò:', error);
            }
        }

        function renderVotes(votes) {
            voteList.innerHTML = '';
            votes.sort((a, b) => b.vote_count - a.vote_count);

            votes.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'vote-item';
                div.innerHTML = `
                    <div class="vote-info">
                        ${index === 0 ? 'üèÜ ' : index === 1 ? 'ü•à ' : index === 2 ? 'ü•â ' : ''}
                        ${index + 1}Îì± - ${item.suggested_name} (${item.vote_count}Ìëú)
                    </div>
                    <button class="vote-button" onclick="vote('${item.suggested_name}')">üëç</button>
                `;
                div.setAttribute('data-reason', item.reason || 'ÏÇ¨Ïú† ÏóÜÏùå');
                div.addEventListener('mouseenter', () => {
                    showTooltip(div.getAttribute('data-reason'));
                    applyBlur();
                });
                div.addEventListener('mouseleave', () => {
                    hideTooltip();
                    removeBlur();
                });
                voteList.appendChild(div);
            });
        }

        async function vote(suggestedName) {
            const name = prompt('ÎãπÏã†Ïùò Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
            if (!name) {
                alert('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ïïº Ìà¨ÌëúÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                return;
            }

            try {
                const response = await fetch('/vote', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, suggestedName })
                });

                if (response.ok) {
                    alert('Ìà¨Ìëú ÏôÑÎ£å!');
                    fetchNames();
                } else {
                    const msg = await response.text();
                    alert(msg || 'Ìà¨Ìëú Ïã§Ìå®');
                }
            } catch (error) {
                console.error('Ìà¨Ìëú Ïò§Î•ò:', error);
            }
        }

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            const name = document.getElementById('name').value.trim();
            const suggestedName = document.getElementById('suggestedName').value.trim();
            const reason = document.getElementById('reason').value.trim();

            if (!name || !suggestedName || !reason) {
                alert('Î™®Îì† Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            try {
                const response = await fetch('/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, suggestedName, reason })
                });

                if (response.ok) {
                    alert('Ï†úÏ∂ú ÏôÑÎ£å!');
                    form.reset();
                    fetchNames();
                } else {
                    const msg = await response.text();
                    alert(msg || 'Ï†úÏ∂ú Ïã§Ìå®');
                }
            } catch (error) {
                console.error('Ï†úÏ∂ú Ïò§Î•ò:', error);
            }
        });

        function showTooltip(text) {
            let tooltip = document.getElementById('tooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.id = 'tooltip';
                tooltip.style.position = 'fixed';
                tooltip.style.top = '50%';
                tooltip.style.left = '50%';
                tooltip.style.transform = 'translate(-50%, -50%)';
                tooltip.style.minWidth = '300px';
                tooltip.style.background = 'rgba(50, 50, 50, 0.9)';
                tooltip.style.color = 'white';
                tooltip.style.padding = '20px 30px';
                tooltip.style.borderRadius = '12px';
                tooltip.style.fontSize = '18px';
                tooltip.style.fontWeight = '500';
                tooltip.style.boxShadow = '0 8px 24px rgba(0, 0, 0, 0.2)';
                tooltip.style.backdropFilter = 'blur(6px)';
                tooltip.style.transition = 'opacity 0.4s ease';
                tooltip.style.pointerEvents = 'none';
                tooltip.style.opacity = '0';
                tooltip.style.zIndex = '1000';
                document.body.appendChild(tooltip);
            }

            tooltip.textContent = text;
            tooltip.style.opacity = '1';
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            if (tooltip) {
                tooltip.style.opacity = '0';
                setTimeout(() => {
                    if (tooltip) {
                        tooltip.remove();
                    }
                }, 400);
            }
        }

        function applyBlur() {
            let blurOverlay = document.getElementById('blur-overlay');
            if (!blurOverlay) {
                blurOverlay = document.createElement('div');
                blurOverlay.id = 'blur-overlay';
                blurOverlay.style.position = 'fixed';
                blurOverlay.style.top = '0';
                blurOverlay.style.left = '0';
                blurOverlay.style.width = '100%';
                blurOverlay.style.height = '100%';
                blurOverlay.style.background = 'rgba(255, 255, 255, 0.3)';
                blurOverlay.style.backdropFilter = 'blur(0px)';
                blurOverlay.style.transition = 'backdrop-filter 0.4s ease, background 0.4s ease';
                blurOverlay.style.zIndex = '998';
                blurOverlay.style.pointerEvents = 'none';
                document.body.appendChild(blurOverlay);
            }

            setTimeout(() => {
                blurOverlay.style.backdropFilter = 'blur(6px)';
                blurOverlay.style.background = 'rgba(255, 255, 255, 0.5)';
            }, 50);
        }

        function removeBlur() {
            const blurOverlay = document.getElementById('blur-overlay');
            if (blurOverlay) {
                blurOverlay.style.backdropFilter = 'blur(0px)';
                blurOverlay.style.background = 'rgba(255, 255, 255, 0.0)';
                setTimeout(() => {
                    if (blurOverlay) {
                        blurOverlay.remove();
                    }
                }, 400);
            }
        }

        fetchNames();
        setInterval(fetchNames, 10000);
    </script>
</body>
</html>
